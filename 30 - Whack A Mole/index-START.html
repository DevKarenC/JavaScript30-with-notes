<!-- Math.random(), Recursion, Multiple CSS class selectors, setTimeout, isTrusted event property -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Whack A Mole!</title>
    <link
      href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Whack-a-mole! <span class="score">0</span></h1>

    <div class="game">
      <div class="hole hole1">
        <div class="mole mole1"></div>
      </div>
      <div class="hole hole2">
        <div class="mole mole2"></div>
      </div>
      <div class="hole hole3">
        <div class="mole mole3"></div>
      </div>
      <div class="hole hole4">
        <div class="mole mole4"></div>
      </div>
      <div class="hole hole5">
        <div class="mole mole5"></div>
      </div>
      <div class="hole hole6">
        <div class="mole mole6"></div>
      </div>
    </div>

    <button class="start">Start!</button>

    <script>
      const holes = document.querySelectorAll(".hole");
      const scoreBoard = document.querySelector(".score");
      const moles = document.querySelectorAll(".mole");
      const startButton = document.querySelector(".start");
      const gameDuration = 10000;
      let minTime = 300;
      let maxTime = 1000;

      // Prevent the mole from appearing in the same hole consecutively
      let lastHole;
      // Determine whether the game is over or not
      let timeUp = false;
      let score = 0;
      // Prevent user from scoring more than 1 point after clicking on the same mole multiple times
      let lastBonkedMole;

      // Get the random amount of time in milliseconds for moles to appear
      function randomTime(min, max) {
        return Math.round(Math.random() * (max - min) + min);
      }

      // Pick a random hole for a mole to appear
      function randomHole(holes) {
        const index = Math.floor(Math.random() * holes.length);
        const hole = holes[index];
        // If the selected hole is the same as the last hole, call and return the randomHole() function again.
        if (hole === lastHole) {
          // recursion
          return randomHole(holes);
        }
        lastHole = hole;
        return hole;
      }

      // Mole peeping (popping up) from a hole
      function peep() {
        const time = randomTime(minTime, maxTime);
        const hole = randomHole(holes);
        hole.classList.add("up");

        // After a random amount of time, remove the class "up" from the hole element.
        // Rather than thinking of a way to execute the function (adding class) for a certain amount of time (duration)
        // think about how to execute the function (remove class) after a certain amount of time (timer).
        setTimeout(() => {
          hole.classList.remove("up");

          lastBonkedMole = undefined;
          // recursion again
          if (!timeUp) peep();
        }, time);
      }

      function startGame() {
        scoreBoard.textContent = 0;
        timeUp = false;
        score = 0;
        peep();
        // Stop the game after 10 seconds
        setTimeout(function () {
          timeUp = true;
        }, gameDuration);
      }

      function bonk(e) {
        // If the event was not generated by a user action, return.
        if (!e.isTrusted) return;

        // Users cannot score more than 1 point from clicking on the same mole multiple times
        if (lastBonkedMole !== e.target.classList[1]) {
          score++;
        }

        lastBonkedMole = e.target.classList[1];

        // When the mole is clicked, it should disappear
        this.parentNode.classList.remove("up");

        // Update the scoreboard with a new score
        scoreBoard.textContent = score;
      }

      startButton.addEventListener("click", startGame);
      moles.forEach((mole) => mole.addEventListener("click", bonk));
    </script>
  </body>
</html>
